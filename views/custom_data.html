{% extends "base.html" %}

{% block content %}
<div class="container py-5">
    {% if message %}
    <div class="alert alert-{{ message.type }} alert-dismissible fade show" role="alert">
        {{ message.text }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <div class="row mb-4">
        <div class="col-12">
            <div class="header-card">
                <h1 class="text-center mb-4">Gerenciador de Dados Personalizados</h1>
                <p class="text-center text-white mb-4">Adicione, visualize e gerencie seus dados personalizados de forma simples e eficiente.</p>
                <div class="quick-guide">
                    <div class="guide-item" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Adicione itens simples à sua lista">
                        <i class="fas fa-list-ul"></i>
                        <span>Lista Simples</span>
                    </div>
                    <div class="guide-separator">
                        <i class="fas fa-plus"></i>
                    </div>
                    <div class="guide-item" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Gerencie dados estruturados em formato JSON">
                        <i class="fas fa-code"></i>
                        <span>Dicionário JSON</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Seção de Lista -->
        <div class="col-md-6">
            <div class="custom-card h-100">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2 class="mb-0">
                            <i class="fas fa-list me-2"></i>Lista Simples
                            <i class="fas fa-question-circle ms-2 text-white-50" 
                               data-bs-toggle="tooltip" 
                               data-bs-placement="right" 
                               title="Adicione itens individuais à sua lista. Cada item pode ser editado ou removido posteriormente."></i>
                        </h2>
                        <form method="POST" action="{{ url_for('clear_custom_data', data_type='list') }}" class="d-inline">
                            <button type="submit" class="btn btn-danger btn-sm" 
                                    data-bs-toggle="tooltip"
                                    data-bs-placement="left"
                                    title="Remove todos os itens da lista"
                                    data-confirm="Tem certeza que deseja limpar toda a lista?">
                                <i class="fas fa-trash-alt me-2"></i>Limpar Lista
                            </button>
                        </form>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Formulário de Lista -->
                    <form method="POST" class="mb-4">
                        <div class="input-group">
                            <input type="text" class="form-control" name="list_item" 
                                   placeholder="Digite um item para a lista..." 
                                   data-bs-toggle="tooltip"
                                   data-bs-placement="top"
                                   title="Digite o texto do item que deseja adicionar"
                                   required>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus-circle me-2"></i>Adicionar
                            </button>
                        </div>
                    </form>

                    <!-- Lista de Itens -->
                    {% if custom_list %}
                    <div class="list-group list-group-flush custom-list">
                        {% for item in custom_list %}
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <span class="item-text">{{ item }}</span>
                            <div class="btn-group action-buttons">
                                <button class="btn btn-outline-primary btn-sm edit-item" 
                                        data-item="{{ item }}" 
                                        data-index="{{ loop.index0 }}"
                                        data-bs-toggle="tooltip"
                                        data-bs-placement="top"
                                        title="Editar este item">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <a href="{{ url_for('remove_item', data_type='list', index=loop.index0) }}" 
                                   class="btn btn-outline-danger btn-sm"
                                   data-bs-toggle="tooltip"
                                   data-bs-placement="top"
                                   title="Remover este item"
                                   data-confirm="Tem certeza que deseja remover este item?">
                                    <i class="fas fa-times"></i>
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="mt-3 d-flex justify-content-between align-items-center">
                        <span class="text-muted small">Clique nos botões <i class="fas fa-edit"></i> ou <i class="fas fa-times"></i> para editar ou remover itens</span>
                        <span class="badge bg-primary">Total: {{ custom_list|length }} item(s)</span>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="fas fa-list fa-3x mb-3"></i>
                        <p>Nenhum item na lista ainda.</p>
                        <p class="small">Adicione itens usando o formulário acima.</p>
                        <button class="btn btn-outline-primary btn-sm mt-2" 
                                onclick="document.querySelector('[name=list_item]').focus()">
                            <i class="fas fa-plus-circle me-2"></i>Começar a Adicionar
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Seção de Dicionário -->
        <div class="col-md-6">
            <div class="custom-card h-100">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2 class="mb-0">
                            <i class="fas fa-code me-2"></i>Dicionário de Dados
                            <i class="fas fa-question-circle ms-2 text-white-50" 
                               data-bs-toggle="tooltip" 
                               data-bs-placement="right" 
                               title="Adicione dados estruturados em formato JSON. Use os modelos predefinidos ou crie seu próprio formato."></i>
                        </h2>
                        <form method="POST" action="{{ url_for('clear_custom_data', data_type='dict') }}" class="d-inline">
                            <button type="submit" class="btn btn-danger btn-sm"
                                    data-bs-toggle="tooltip"
                                    data-bs-placement="left"
                                    title="Remove todos os dados do dicionário"
                                    data-confirm="Tem certeza que deseja limpar todo o dicionário?">
                                <i class="fas fa-trash-alt me-2"></i>Limpar Dicionário
                            </button>
                        </form>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Formulário de Dicionário -->
                    <form method="POST" class="mb-4" id="jsonForm">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="form-label">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Adicione dados em formato JSON
                                </label>
                                <div class="json-help">
                                    <button type="button" class="btn btn-link btn-sm text-info p-0" 
                                            data-bs-toggle="modal" 
                                            data-bs-target="#jsonHelpModal">
                                        <i class="fas fa-question-circle"></i> Como usar JSON?
                                    </button>
                                </div>
                            </div>
                            <div class="d-flex gap-2 mb-2">
                                <div class="dropdown">
                                    <button class="btn btn-secondary dropdown-toggle" 
                                            type="button" 
                                            data-bs-toggle="dropdown"
                                            data-bs-toggle="tooltip"
                                            data-bs-placement="top"
                                            title="Use um modelo predefinido como base">
                                        <i class="fas fa-file-code me-1"></i> Modelos
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#" onclick="setTemplate('pessoa')">
                                            <i class="fas fa-user me-2"></i>Pessoa
                                        </a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setTemplate('produto')">
                                            <i class="fas fa-box me-2"></i>Produto
                                        </a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setTemplate('evento')">
                                            <i class="fas fa-calendar me-2"></i>Evento
                                        </a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item" href="#" onclick="setTemplate('astronauta')">
                                            <i class="fas fa-user-astronaut me-2"></i>Astronauta
                                        </a></li>
                                    </ul>
                                </div>
                                <button type="button" 
                                        class="btn btn-outline-secondary" 
                                        onclick="formatJson()"
                                        data-bs-toggle="tooltip"
                                        data-bs-placement="top"
                                        title="Organiza o JSON para melhor visualização">
                                    <i class="fas fa-align-left me-1"></i> Formatar JSON
                                </button>
                            </div>
                            <textarea class="form-control code-editor" 
                                     id="json_data" 
                                     name="json_data" 
                                     rows="8" 
                                     required
                                     placeholder="Digite ou cole seu JSON aqui..."></textarea>
                            <div id="jsonValidationMessage" class="form-text mt-1"></div>
                            <div class="json-tips mt-2 small text-muted">
                                <i class="fas fa-lightbulb me-1"></i> Dica: Use os modelos predefinidos como base ou cole seu próprio JSON
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" id="submitJsonBtn">
                            <i class="fas fa-plus-circle me-2"></i>Adicionar ao Dicionário
                        </button>
                    </form>

                    <!-- Tabela de Dicionários -->
                    {% if custom_dict %}
                    <div class="table-responsive custom-table">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Dados</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in custom_dict %}
                                <tr>
                                    <td>{{ loop.index }}</td>
                                    <td>
                                        <pre class="mb-0 json-display"><code>{{ item | tojson(indent=2) }}</code></pre>
                                    </td>
                                    <td>
                                        <div class="btn-group">
                                            <button class="btn btn-outline-primary btn-sm edit-json" 
                                                    data-json='{{ item | tojson }}' 
                                                    data-index="{{ loop.index0 }}"
                                                    data-bs-toggle="tooltip"
                                                    data-bs-placement="top"
                                                    title="Editar este item">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <a href="{{ url_for('remove_item', data_type='dict', index=loop.index0) }}" 
                                               class="btn btn-outline-danger btn-sm"
                                               data-bs-toggle="tooltip"
                                               data-bs-placement="top"
                                               title="Remover este item"
                                               data-confirm="Tem certeza que deseja remover este item?">
                                                <i class="fas fa-times"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-3 d-flex justify-content-between align-items-center">
                        <span class="text-muted small">Clique nos botões <i class="fas fa-edit"></i> ou <i class="fas fa-times"></i> para editar ou remover itens</span>
                        <span class="badge bg-primary">Total: {{ custom_dict|length }} item(s)</span>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="fas fa-code fa-3x mb-3"></i>
                        <p>Nenhum dicionário adicionado ainda.</p>
                        <p class="small">Use os modelos ou adicione seu próprio JSON.</p>
                        <div class="mt-3">
                            <button class="btn btn-outline-primary btn-sm" onclick="setTemplate('pessoa')">
                                <i class="fas fa-file-code me-2"></i>Usar Modelo de Exemplo
                            </button>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Ajuda JSON -->
<div class="modal fade" id="jsonHelpModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-question-circle me-2"></i>
                    Como usar JSON?
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="json-help-content">
                    <h6 class="mb-3">O que é JSON?</h6>
                    <p>JSON (JavaScript Object Notation) é um formato leve de troca de dados. É fácil para humanos ler e escrever e fácil para máquinas analisar e gerar.</p>
                    
                    <h6 class="mt-4 mb-3">Estrutura Básica</h6>
                    <pre class="json-example">
{
    "nome": "João Silva",
    "idade": 30,
    "email": "joao@email.com"
}</pre>
                    
                    <h6 class="mt-4 mb-3">Tipos de Dados Suportados</h6>
                    <ul class="json-types">
                        <li><code>"texto"</code> - Textos entre aspas duplas</li>
                        <li><code>42</code> - Números</li>
                        <li><code>true</code> ou <code>false</code> - Valores booleanos</li>
                        <li><code>null</code> - Valor nulo</li>
                        <li><code>[]</code> - Arrays (listas)</li>
                        <li><code>{}</code> - Objetos (dicionários)</li>
                    </ul>

                    <div class="alert alert-info mt-4">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Dica:</strong> Use o botão "Formatar JSON" para organizar automaticamente seu código e verificar se está válido.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para edição de item da lista -->
<div class="modal fade" id="editItemModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Editar Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editItemForm" method="POST" action="{{ url_for('custom_data_page') }}">
                <div class="modal-body">
                    <input type="hidden" name="edit_type" value="list">
                    <input type="hidden" name="edit_index" id="editItemIndex">
                    <div class="mb-3">
                        <label for="editItemValue" class="form-label">Item</label>
                        <input type="text" class="form-control" id="editItemValue" name="edit_value" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para edição de JSON -->
<div class="modal fade" id="editJsonModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Editar JSON</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editJsonForm" method="POST" action="{{ url_for('custom_data_page') }}">
                <div class="modal-body">
                    <input type="hidden" name="edit_type" value="dict">
                    <input type="hidden" name="edit_index" id="editJsonIndex">
                    <div class="mb-3">
                        <button type="button" class="btn btn-outline-secondary btn-sm mb-2" onclick="formatEditJson()">
                            <i class="fas fa-align-left me-1"></i> Formatar JSON
                        </button>
                        <textarea class="form-control code-editor" id="editJsonValue" name="edit_value" rows="10" required></textarea>
                        <div id="editJsonValidationMessage" class="form-text mt-1"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary" id="saveJsonBtn">Salvar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal de Confirmação -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                    Confirmação
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="confirmationButton">Confirmar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Erro -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    Erro
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="errorMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<style>
/* Estilos gerais */
.container {
    background: linear-gradient(to bottom, #ffffff, #f8f9fa);
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(0,0,0,0.05);
}

/* Header */
.header-card {
    text-align: center;
    padding: 2rem;
    margin-bottom: 2rem;
    background: linear-gradient(45deg, #005288, #0077cc);
    border-radius: 12px;
    color: white;
    box-shadow: 0 4px 15px rgba(0,82,136,0.2);
}

.header-card h1 {
    font-weight: 700;
    letter-spacing: -1px;
    margin-bottom: 1rem;
}

/* Cards personalizados */
.custom-card {
    background: white;
    border-radius: 12px;
    border: none;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.custom-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 15px rgba(0,0,0,0.1);
}

.custom-card .card-header {
    background: linear-gradient(45deg, #005288, #0077cc);
    color: white;
    border-radius: 12px 12px 0 0;
    padding: 1.5rem;
    border: none;
}

.custom-card .card-header h2 {
    font-size: 1.5rem;
    font-weight: 600;
}

/* Lista personalizada */
.custom-list .list-group-item {
    border: none;
    background: #f8f9fa;
    margin-bottom: 0.5rem;
    border-radius: 8px !important;
    transition: all 0.3s ease;
}

.custom-list .list-group-item:hover {
    background: #e9ecef;
    transform: translateX(5px);
}

/* Editor de código */
.code-editor {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
}

/* JSON Display */
.json-display {
    background-color: #f8f9fa;
    border-radius: 8px;
    padding: 1rem;
    max-height: 200px;
    overflow-y: auto;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
}

/* Tabela personalizada */
.custom-table {
    border-radius: 8px;
    overflow: hidden;
}

.custom-table thead {
    background: linear-gradient(45deg, #005288, #0077cc);
    color: white;
}

.custom-table th {
    border: none;
    padding: 1rem;
}

/* Estado vazio */
.empty-state {
    text-align: center;
    padding: 3rem;
    color: #6c757d;
}

.empty-state i {
    color: #005288;
    opacity: 0.5;
}

/* Botões */
.btn-primary {
    background: linear-gradient(45deg, #005288, #0077cc);
    border: none;
    border-radius: 8px;
    padding: 0.5rem 1rem;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,82,136,0.2);
}

.btn-outline-primary {
    color: #005288;
    border-color: #005288;
    border-radius: 8px;
}

.btn-outline-primary:hover {
    background: linear-gradient(45deg, #005288, #0077cc);
    border-color: transparent;
}

/* Badges */
.badge {
    padding: 0.6em 1em;
    border-radius: 20px;
    font-weight: 500;
}

/* Animações */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.custom-card {
    animation: fadeIn 0.6s ease backwards;
}

.col-md-6:nth-child(2) .custom-card {
    animation-delay: 0.2s;
}

/* Responsividade */
@media (max-width: 768px) {
    .header-card {
        padding: 1.5rem;
    }
    
    .custom-card .card-header {
        padding: 1rem;
    }
    
    .custom-card .card-header h2 {
        font-size: 1.2rem;
    }
}

/* Novos estilos para melhorar a intuitividade */
.quick-guide {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 2rem;
    margin-top: 2rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
}

.guide-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: white;
    cursor: help;
}

.guide-item i {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.guide-separator {
    color: rgba(255, 255, 255, 0.5);
}

.json-help-content {
    font-size: 0.95rem;
}

.json-example {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
}

.json-types {
    list-style: none;
    padding-left: 0;
}

.json-types li {
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.json-types code {
    background: #f8f9fa;
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    color: #005288;
}

.action-buttons {
    opacity: 0.2;
    transition: opacity 0.3s ease;
}

.list-group-item:hover .action-buttons {
    opacity: 1;
}

.json-tips {
    color: #6c757d;
    font-style: italic;
}

/* Melhorias nos tooltips */
.tooltip {
    font-size: 0.85rem;
}

.tooltip-inner {
    max-width: 250px;
    padding: 0.5rem 1rem;
    background: rgba(0, 82, 136, 0.95);
    backdrop-filter: blur(5px);
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

/* Estilos para os modais */
.modal-content {
    border: none;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 82, 136, 0.15);
    background: linear-gradient(to bottom, #ffffff, #f8f9fa);
}

.modal-header {
    background: linear-gradient(45deg, #005288, #0077cc);
    color: white;
    border-radius: 12px 12px 0 0;
    border-bottom: none;
    padding: 1.5rem;
}

.modal-title {
    font-weight: 600;
    letter-spacing: -0.5px;
}

.modal-header .btn-close {
    filter: brightness(0) invert(1);
    opacity: 0.8;
    transition: opacity 0.3s ease;
}

.modal-header .btn-close:hover {
    opacity: 1;
}

.modal-body {
    padding: 1.5rem;
    font-size: 1rem;
}

.modal-footer {
    background: rgba(248, 249, 250, 0.8);
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 0 0 12px 12px;
    padding: 1rem 1.5rem;
}

/* Estilos específicos para cada tipo de modal */
#confirmationModal .modal-header {
    background: linear-gradient(45deg, #005288, #0077cc);
}

#errorModal .modal-header {
    background: linear-gradient(45deg, #dc3545, #ff4d5a);
}

#jsonHelpModal .modal-header {
    background: linear-gradient(45deg, #005288, #0077cc);
}

#editItemModal .modal-header,
#editJsonModal .modal-header {
    background: linear-gradient(45deg, #005288, #0077cc);
}

/* Estilos para os botões dos modais */
.modal .btn {
    padding: 0.5rem 1.5rem;
    font-weight: 500;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.modal .btn-primary {
    background: linear-gradient(45deg, #005288, #0077cc);
    border: none;
    color: white;
}

.modal .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 82, 136, 0.2);
}

.modal .btn-secondary {
    background: #6c757d;
    border: none;
    color: white;
}

.modal .btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-2px);
}

/* Estilos para elementos dentro dos modais */
.modal .form-control {
    border-radius: 8px;
    border: 1px solid rgba(0, 0, 0, 0.1);
    padding: 0.75rem 1rem;
    transition: all 0.3s ease;
}

.modal .form-control:focus {
    border-color: #005288;
    box-shadow: 0 0 0 0.2rem rgba(0, 82, 136, 0.25);
}

.modal .form-label {
    font-weight: 500;
    color: #495057;
    margin-bottom: 0.5rem;
}

/* Animações dos modais */
.modal.fade .modal-dialog {
    transform: scale(0.95);
    transition: transform 0.3s ease;
}

.modal.show .modal-dialog {
    transform: scale(1);
}

/* Estilos para o conteúdo de ajuda JSON */
.json-help-content h6 {
    color: #005288;
    font-weight: 600;
    margin-top: 1.5rem;
}

.json-example {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid rgba(0, 0, 0, 0.1);
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    margin: 1rem 0;
}

.json-types {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.modal .alert {
    border: none;
    border-radius: 8px;
}

.modal .alert-info {
    background: linear-gradient(45deg, #17a2b8, #20c997);
    color: white;
}

/* Responsividade dos modais */
@media (max-width: 768px) {
    .modal-body {
        padding: 1rem;
    }
    
    .modal-header {
        padding: 1rem;
    }
    
    .modal-footer {
        padding: 1rem;
    }
    
    .json-example {
        padding: 1rem;
        font-size: 0.9rem;
    }
}

/* Melhorias na acessibilidade */
.modal-dialog:focus {
    outline: none;
}

.modal .btn:focus {
    box-shadow: 0 0 0 0.2rem rgba(0, 82, 136, 0.25);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Formata o JSON no textarea quando colado
    document.getElementById('json_data').addEventListener('paste', function(e) {
        setTimeout(() => {
            try {
                const json = JSON.parse(this.value);
                this.value = JSON.stringify(json, null, 4);
                validateJson(this.value);
            } catch (e) {
                // Se não for JSON válido, mantém o texto original
            }
        }, 0);
    });

    // Validação de JSON em tempo real
    document.getElementById('json_data').addEventListener('input', function() {
        validateJson(this.value);
    });

    // Validação de JSON de edição em tempo real
    document.getElementById('editJsonValue').addEventListener('input', function() {
        validateEditJson(this.value);
    });

    // Configurar modal de edição de item
    const editItemModal = new bootstrap.Modal(document.getElementById('editItemModal'));
    document.querySelectorAll('.edit-item').forEach(button => {
        button.addEventListener('click', function() {
            const item = this.getAttribute('data-item');
            const index = this.getAttribute('data-index');
            document.getElementById('editItemValue').value = item;
            document.getElementById('editItemIndex').value = index;
            editItemModal.show();
        });
    });

    // Configurar modal de edição de JSON
    const editJsonModal = new bootstrap.Modal(document.getElementById('editJsonModal'));
    document.querySelectorAll('.edit-json').forEach(button => {
        button.addEventListener('click', function() {
            const json = JSON.parse(this.getAttribute('data-json'));
            const index = this.getAttribute('data-index');
            document.getElementById('editJsonValue').value = JSON.stringify(json, null, 4);
            document.getElementById('editJsonIndex').value = index;
            validateEditJson(document.getElementById('editJsonValue').value);
            editJsonModal.show();
        });
    });

    // Inicializar todos os tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    });

    // Remover tooltips ao clicar em dispositivos móveis
    if ('ontouchstart' in window) {
        tooltipList.forEach(tooltip => {
            tooltip._element.addEventListener('click', () => {
                tooltip.hide();
            });
        });
    }
});

// Templates para facilitar a entrada de dados
const templates = {
    pessoa: {
        nome: "João Silva",
        idade: 30,
        email: "joao@email.com",
        telefone: "(11) 99999-9999"
    },
    produto: {
        nome: "Produto Exemplo",
        preco: 99.99,
        categoria: "Eletrônicos",
        estoque: 50
    },
    evento: {
        titulo: "Evento Exemplo",
        data: "2024-03-20",
        local: "São Paulo",
        participantes: 100
    },
    astronauta: {
        nome: "Robert Behnken",
        agencia: "NASA",
        imagem: "https://i.imgur.com/0smMgMH.png",
        wikipedia: "https://en.wikipedia.org/wiki/Robert_L._Behnken",
        lancamentos: [
            "5eb87d46ffd86e000604b388"
        ],
        status: "ativo",
        id: "5ebf1a6e23a9a60006e03a7a"
    }
};

function setTemplate(type) {
    const textarea = document.getElementById('json_data');
    textarea.value = JSON.stringify(templates[type], null, 4);
    validateJson(textarea.value);
}

function formatJson() {
    const textarea = document.getElementById('json_data');
    try {
        const json = JSON.parse(textarea.value);
        textarea.value = JSON.stringify(json, null, 4);
        validateJson(textarea.value);
    } catch (e) {
        document.getElementById('jsonValidationMessage').innerHTML = 
            '<div class="alert alert-danger py-2 px-3 mb-0"><i class="fas fa-exclamation-triangle me-2"></i>JSON inválido: ' + e.message + '</div>';
    }
}

function formatEditJson() {
    const textarea = document.getElementById('editJsonValue');
    try {
        const json = JSON.parse(textarea.value);
        textarea.value = JSON.stringify(json, null, 4);
        validateEditJson(textarea.value);
    } catch (e) {
        document.getElementById('editJsonValidationMessage').innerHTML = 
            '<div class="alert alert-danger py-2 px-3 mb-0"><i class="fas fa-exclamation-triangle me-2"></i>JSON inválido: ' + e.message + '</div>';
    }
}

function validateJson(jsonString) {
    const messageElement = document.getElementById('jsonValidationMessage');
    const submitButton = document.getElementById('submitJsonBtn');
    
    if (!jsonString.trim()) {
        messageElement.innerHTML = '';
        submitButton.disabled = true;
        return;
    }
    
    try {
        JSON.parse(jsonString);
        messageElement.innerHTML = 
            '<div class="alert alert-success py-2 px-3 mb-0"><i class="fas fa-check-circle me-2"></i>JSON válido! Pronto para adicionar.</div>';
        submitButton.disabled = false;
    } catch (e) {
        messageElement.innerHTML = 
            '<div class="alert alert-danger py-2 px-3 mb-0"><i class="fas fa-exclamation-triangle me-2"></i>JSON inválido: ' + e.message + '</div>';
        submitButton.disabled = true;
    }
}

function validateEditJson(jsonString) {
    const messageElement = document.getElementById('editJsonValidationMessage');
    const submitButton = document.getElementById('saveJsonBtn');
    
    if (!jsonString.trim()) {
        messageElement.innerHTML = '';
        submitButton.disabled = true;
        return;
    }
    
    try {
        JSON.parse(jsonString);
        messageElement.innerHTML = 
            '<div class="alert alert-success py-2 px-3 mb-0"><i class="fas fa-check-circle me-2"></i>JSON válido! Pronto para adicionar.</div>';
        submitButton.disabled = false;
    } catch (e) {
        messageElement.innerHTML = 
            '<div class="alert alert-danger py-2 px-3 mb-0"><i class="fas fa-exclamation-triangle me-2"></i>JSON inválido: ' + e.message + '</div>';
        submitButton.disabled = true;
    }
}

// Função para mostrar modal de confirmação
function showConfirmation(message, callback) {
    const modal = new bootstrap.Modal(document.getElementById('confirmationModal'));
    document.getElementById('confirmationMessage').textContent = message;
    
    const confirmButton = document.getElementById('confirmationButton');
    const handleConfirm = () => {
        modal.hide();
        callback();
        confirmButton.removeEventListener('click', handleConfirm);
    };
    
    confirmButton.addEventListener('click', handleConfirm);
    modal.show();
}

// Função para mostrar modal de erro
function showError(message) {
    const modal = new bootstrap.Modal(document.getElementById('errorModal'));
    document.getElementById('errorMessage').textContent = message;
    modal.show();
}

// Atualizar os event listeners de confirmação
document.querySelectorAll('[data-confirm]').forEach(element => {
    element.addEventListener('click', function(e) {
        e.preventDefault();
        const message = this.getAttribute('data-confirm');
        const href = this.getAttribute('href');
        
        showConfirmation(message, () => {
            if (href) {
                window.location.href = href;
            } else if (this.form) {
                this.form.submit();
            }
        });
    });
});

// Atualizar o botão de limpar lista
document.querySelectorAll('[data-type="clear"]').forEach(button => {
    button.addEventListener('click', function(e) {
        e.preventDefault();
        const type = this.getAttribute('data-clear-type');
        const form = this.closest('form');
        
        showConfirmation(`Tem certeza que deseja limpar ${type === 'list' ? 'toda a lista' : 'todo o dicionário'}?`, () => {
            form.submit();
        });
    });
});

// Atualizar o botão de remover item
document.querySelectorAll('[data-type="remove"]').forEach(button => {
    button.addEventListener('click', function(e) {
        e.preventDefault();
        const href = this.getAttribute('href');
        
        showConfirmation('Tem certeza que deseja remover este item?', () => {
            window.location.href = href;
        });
    });
});

// Atualizar validação de JSON
function validateJson(jsonString) {
    const messageElement = document.getElementById('jsonValidationMessage');
    const submitButton = document.getElementById('submitJsonBtn');
    
    if (!jsonString.trim()) {
        messageElement.innerHTML = '';
        submitButton.disabled = true;
        return;
    }
    
    try {
        JSON.parse(jsonString);
        messageElement.innerHTML = 
            '<div class="alert alert-success py-2 px-3 mb-0"><i class="fas fa-check-circle me-2"></i>JSON válido! Pronto para adicionar.</div>';
        submitButton.disabled = false;
    } catch (e) {
        messageElement.innerHTML = 
            '<div class="alert alert-danger py-2 px-3 mb-0"><i class="fas fa-exclamation-triangle me-2"></i>JSON inválido: ' + e.message + '</div>';
        submitButton.disabled = true;
    }
}

// Atualizar validação de formulário JSON
document.getElementById('jsonForm').addEventListener('submit', function(e) {
    try {
        JSON.parse(document.getElementById('json_data').value);
    } catch (error) {
        e.preventDefault();
        showError('Por favor, corrija o JSON antes de enviar. O formato está inválido.');
    }
});

// Atualizar validação de formulário de edição JSON
document.getElementById('editJsonForm').addEventListener('submit', function(e) {
    try {
        JSON.parse(document.getElementById('editJsonValue').value);
    } catch (error) {
        e.preventDefault();
        showError('Por favor, corrija o JSON antes de enviar. O formato está inválido.');
    }
});

// Atualizar os botões de limpar
document.querySelectorAll('.btn-danger[data-bs-toggle="tooltip"]').forEach(button => {
    button.removeAttribute('onclick');
    button.addEventListener('click', function(e) {
        e.preventDefault();
        const form = this.closest('form');
        const type = form.action.includes('list') ? 'lista' : 'dicionário';
        
        showConfirmation(`Tem certeza que deseja limpar ${type === 'lista' ? 'toda a lista' : 'todo o dicionário'}?`, () => {
            form.submit();
        });
    });
});

// Atualizar os links de remoção
document.querySelectorAll('a[href*="remove_item"]').forEach(link => {
    link.removeAttribute('onclick');
    link.addEventListener('click', function(e) {
        e.preventDefault();
        const href = this.getAttribute('href');
        
        showConfirmation('Tem certeza que deseja remover este item?', () => {
            window.location.href = href;
        });
    });
});
</script>
{% endblock %} 